/******************** (C) COPYRIGHT 2024 SONiX *******************************
* COMPANY:	SONiX
* DATE:		  2025/01
* AUTHOR:		HCW
* IC:			  SR56F27
*____________________________________________________________________________
* REVISION		Date				User		Description
*____________________________________________________________________________
*****************************************************************************/

/*_____ I N C L U D E S ____________________________________________________*/
#include "timer0.h"
#include "system.h"

/*_____ D E C L A R A T I O N S ____________________________________________*/


/*_____ D E F I N I T I O N S ______________________________________________*/


/*_____ M A C R O S ________________________________________________________*/

/*_____ F U N C T I O N S __________________________________________________*/



//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#define TIMER0_RELOAD_VALUE (0xFFFF - 3999) //4000 * 32MHz = 125us

void Timer0_Init() {
  T0M = 0;
  T0M |= DIV_1 | CLK_FHOSC;
  
  T0RH = (TIMER0_RELOAD_VALUE>>8);
  T0RL = TIMER0_RELOAD_VALUE;
  
  T0CH = (TIMER0_RELOAD_VALUE>>8);
  T0CL = TIMER0_RELOAD_VALUE;
    
  // Clear TF0
  TCON &= ~mskTF0;
  
  // Enable Timer0 interrupt
  ET0 = 1;

  // Enable Timer0
  T0M |= mskT0EN;
  
}


/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void Timer0_ISR() interrupt ISRTimer0
{
    system_ticks++;       // Increase 125 μs counter
    ISR_f_125us = 1;      // Set 125 μs flag
  
}
